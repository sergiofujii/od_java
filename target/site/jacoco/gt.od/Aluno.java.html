<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Aluno.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">demo</a> &gt; <a href="index.source.html" class="el_package">gt.od</a> &gt; <span class="el_source">Aluno.java</span></div><h1>Aluno.java</h1><pre class="source lang-java linenums">package gt.od;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

public class Aluno {

<span class="nc" id="L13">	private Connection connection = null;</span>
	private int id;
	private String matricula;
	private String nome;
	// private String dataNasc;
	private String curso;
	// private float  coeficienteRendimento;
	// private float  coeficienteProgressao;
	// private int chTotalCumprida;
	// private int chEstagioCumprida;
	// private int chObrigatoriaCumprida;

	private String ingresso;
	private String periodo;
	private String matriz;
	private String cpf;
	private String email;
	private String situacao_sistemica;


	private List&lt;Disciplina&gt; disciplinas;

	public void setId(int id) {
<span class="nc" id="L36">		this.id = id;</span>
<span class="nc" id="L37">	}</span>

	public void setMatricula(String matricula) {
<span class="nc" id="L40">		this.matricula = matricula;</span>
<span class="nc" id="L41">	}</span>

	public void setNome(String nome) {
<span class="nc" id="L44">		this.nome = nome;</span>
<span class="nc" id="L45">	}</span>

	public void setCurso(String curso) {
<span class="nc" id="L48">		this.curso = curso;</span>
<span class="nc" id="L49">	}</span>

	// Getter para o atributo &quot;ingresso&quot;
	public String getIngresso() {
<span class="nc" id="L53">		return ingresso;</span>
	}

	// Setter para o atributo &quot;ingresso&quot;
	public void setIngresso(String ingresso) {
<span class="nc" id="L58">		this.ingresso = ingresso;</span>
<span class="nc" id="L59">	}</span>

	// Getter para o atributo &quot;periodo&quot;
	public String getPeriodo() {
<span class="nc" id="L63">		return periodo;</span>
	}

	// Setter para o atributo &quot;periodo&quot;
	public void setPeriodo(String periodo) {
<span class="nc" id="L68">		this.periodo = periodo;</span>
<span class="nc" id="L69">	}</span>

	// Getter para o atributo &quot;matriz&quot;
	public String getMatriz() {
<span class="nc" id="L73">		return matriz;</span>
	}

	// Setter para o atributo &quot;matriz&quot;
	public void setMatriz(String matriz) {
<span class="nc" id="L78">		this.matriz = matriz;</span>
<span class="nc" id="L79">	}</span>

	// Getter para o atributo &quot;cpf&quot;
	public String getCpf() {
<span class="nc" id="L83">		return cpf;</span>
	}

	// Setter para o atributo &quot;cpf&quot;
	public void setCpf(String cpf) {
<span class="nc" id="L88">		this.cpf = cpf;</span>
<span class="nc" id="L89">	}</span>

	// Getter para o atributo &quot;email&quot;
	public String getEmail() {
<span class="nc" id="L93">		return email;</span>
	}

	// Setter para o atributo &quot;email&quot;
	public void setEmail(String email) {
<span class="nc" id="L98">		this.email = email;</span>
<span class="nc" id="L99">	}</span>

	// Getter para o atributo &quot;situacao_sistemica&quot;
	public String getSituacaoSistemica() {
<span class="nc" id="L103">		return situacao_sistemica;</span>
	}

	// Setter para o atributo &quot;situacao_sistemica&quot;
	public void setSituacaoSistemica(String situacao_sistemica) {
<span class="nc" id="L108">		this.situacao_sistemica = situacao_sistemica;</span>
<span class="nc" id="L109">	}</span>

	private void closeConnection() {
		try {
<span class="nc" id="L113">			connection.close();</span>
<span class="nc" id="L114">		} catch (SQLException ex) {</span>
<span class="nc" id="L115">			System.out.println(ex.toString());</span>
<span class="nc" id="L116">		}</span>
<span class="nc" id="L117">	}</span>

<span class="nc" id="L119">    public Aluno(){</span>
<span class="nc" id="L120">		disciplinas = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L122">    }</span>
	
	public void setDisciplinas(List&lt;Disciplina&gt; disciplinas) {
<span class="nc" id="L125">		this.disciplinas = disciplinas;</span>
<span class="nc" id="L126">	}</span>

	public List&lt;Disciplina&gt; getDisciplinas() {
<span class="nc" id="L129">		return this.disciplinas;</span>
	}

	public void salvar(){
<span class="nc" id="L133">		openConnection();</span>
<span class="nc" id="L134">		salvarAluno();</span>
		// salvarDisciplinasCursadas();
<span class="nc" id="L136">		closeConnection();</span>
<span class="nc" id="L137">	}</span>

	private void salvarAluno(){
<span class="nc" id="L140">		Statement stmt = null;</span>
<span class="nc" id="L141">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L143">			stmt = connection.createStatement();</span>
<span class="nc" id="L144">			String query = &quot;select * from alunos where matricula='&quot; + this.matricula + &quot;';&quot;;</span>
<span class="nc" id="L145">			rs = stmt.executeQuery(query);</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">			if (!rs.next()) {</span>
<span class="nc" id="L147">				query = &quot;INSERT INTO alunos (nome, matricula, curso, ingresso, periodo, matriz, cpf, email, situacao_sistemica) &quot; +</span>
				&quot;VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)&quot;;
<span class="nc" id="L149">				PreparedStatement ps = connection.prepareStatement(query, Statement.RETURN_GENERATED_KEYS);</span>
<span class="nc" id="L150">				ps.setString(1, this.nome);</span>
<span class="nc" id="L151">				ps.setString(2, this.matricula);</span>
<span class="nc" id="L152">				ps.setString(3, this.curso);</span>
<span class="nc" id="L153">				ps.setString(4, this.ingresso);</span>
<span class="nc" id="L154">				ps.setString(5, this.periodo);</span>
<span class="nc" id="L155">				ps.setString(6, this.matriz);</span>
<span class="nc" id="L156">				ps.setString(7, this.cpf);</span>
<span class="nc" id="L157">				ps.setString(8, this.email);</span>
<span class="nc" id="L158">				ps.setString(9, this.situacao_sistemica);</span>


<span class="nc" id="L161">				ps.executeUpdate();</span>
<span class="nc" id="L162">				ResultSet generatedKeys = ps.getGeneratedKeys();</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">                if(generatedKeys.next()){</span>
<span class="nc" id="L164">                    this.id = generatedKeys.getInt(1);</span>
                }
<span class="nc" id="L166">			} else {</span>
				// System.out.println(&quot;ALUNO PRE EXISTENTE&quot;);
				//then load its ID
<span class="nc" id="L169">				this.id = rs.getInt(&quot;id&quot;);</span>
			}
<span class="nc" id="L171">		} catch (SQLException ex) {</span>
<span class="nc" id="L172">			System.out.println(ex.toString());</span>
<span class="nc" id="L173">			ex.printStackTrace();</span>
<span class="nc" id="L174">		}</span>
<span class="nc" id="L175">	}</span>

	private void salvarDisciplinasCursadas(){
<span class="nc" id="L178">		Statement stmt = null;</span>
<span class="nc" id="L179">		ResultSet rs = null;</span>

<span class="nc bnc" id="L181" title="All 2 branches missed.">		for (Disciplina disciplina : disciplinas) {</span>
			// salva no banco se nao existe, e atualiza o ID.
<span class="nc" id="L183">			disciplina.salvar(this.connection); </span>
			// agora registra na tabela aluno_cursa_disciplina
			try {
<span class="nc" id="L186">				stmt = connection.createStatement();</span>
<span class="nc" id="L187">				String query = &quot;select * from aluno_cursa_disciplina where aluno_id=&quot; + this.id </span>
<span class="nc" id="L188">							+ &quot; and disciplina_id=&quot;+disciplina.getId()+&quot; and ano=&quot;+disciplina.getAno()+&quot;;&quot;;</span>
<span class="nc" id="L189">				rs = stmt.executeQuery(query);</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">				if (!rs.next()) {</span>
<span class="nc" id="L191">					query = &quot;INSERT INTO `aluno_cursa_disciplina` (`aluno_id`, `disciplina_id`, `ano`, `nf1e`, `nf2e`&quot;+</span>
					&quot;, `frequencia`, `situacao`) VALUES (?, ?, ?, ?, ?, ?, ?)&quot;;
<span class="nc" id="L193">					PreparedStatement ps = connection.prepareStatement(query);</span>
<span class="nc" id="L194">					ps.setInt(1, this.id);</span>
<span class="nc" id="L195">					ps.setInt(2, disciplina.getId());</span>
<span class="nc" id="L196">					ps.setInt(3, disciplina.getAno());</span>
<span class="nc" id="L197">					ps.setFloat(4, disciplina.getNf1e());</span>
<span class="nc" id="L198">					ps.setFloat(5, disciplina.getNf2e());</span>
<span class="nc" id="L199">					ps.setFloat(6, disciplina.getFrequencia());</span>
<span class="nc" id="L200">					ps.setString(7, disciplina.getSituacao());</span>
<span class="nc" id="L201">					ps.executeUpdate();</span>
				} else { // se já tem o registro, não faz nada
					// System.out.println(&quot;REGISTRO PRE EXISTENTE&quot;);
				}
<span class="nc" id="L205">			} catch (SQLException ex) {</span>
<span class="nc" id="L206">				System.out.println(ex.toString());</span>
<span class="nc" id="L207">				ex.printStackTrace();</span>
<span class="nc" id="L208">			}</span>
<span class="nc" id="L209">		}</span>
<span class="nc" id="L210">	}</span>


	private void openConnection() {
		try {
			// Carregando o JDBC Driver padrão
			// String driverName = &quot;com.mysql.jdbc.Driver&quot;;
<span class="nc" id="L217">			String driverName = &quot;com.mysql.cj.jdbc.Driver&quot;;</span>
<span class="nc" id="L218">			Class.forName(driverName);</span>
			// Configurando a nossa conexão com um banco de dados//
<span class="nc" id="L220">			String serverName = &quot;localhost&quot;; // caminho do servidor do BD</span>
<span class="nc" id="L221">			String mydatabase = &quot;od_suap&quot;; // nome do seu banco de dados</span>
<span class="nc" id="L222">			String url = &quot;jdbc:mysql://&quot; + serverName + &quot;/&quot; + mydatabase;</span>
<span class="nc" id="L223">			String username = &quot;gtdaod&quot;; // nome de um usuário de seu BD</span>
<span class="nc" id="L224">			String password = &quot;senhagtdaod&quot;; // sua senha de acesso</span>
<span class="nc" id="L225">			connection = DriverManager.getConnection(url, username, password);</span>
			// Testa sua conexão//
<span class="nc bnc" id="L227" title="All 2 branches missed.">			if (connection == null) {</span>
<span class="nc" id="L228">				System.out.println(&quot;STATUS---&gt;Não foi possivel realizar conexão&quot;);</span>
			} else {
				// System.out.println(&quot;STATUS---&gt;Conectado com sucesso!&quot;);
			}
<span class="nc" id="L232">		} catch (ClassNotFoundException e) { // Driver não encontrado</span>
<span class="nc" id="L233">			System.out.println(&quot;O driver expecificado nao foi encontrado.&quot;);</span>
<span class="nc" id="L234">		} catch (SQLException e) {</span>
			// Não conseguindo se conectar ao banco
<span class="nc" id="L236">			System.out.println(&quot;Nao foi possivel conectar ao Banco de Dados.&quot;);</span>
<span class="nc" id="L237">		}</span>
<span class="nc" id="L238">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>